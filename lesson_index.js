var trainingArray = [];

trainingArray.push({"Name":"zone2_2hr","TrainingData":[{"ftp":0.75,"time":"120m","color":"#3DB33F"}]});
trainingArray.push({"Name":"zone3+zone2_1HR","TrainingData":[{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.9,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.9,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.9,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.9,"time":"5m","color":"#FCD549"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.7,"time":"10m","color":"#3DB33F"}]});
trainingArray.push({"Name":"zone3+zone2_1HR_v2","TrainingData":[{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":0.73,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":0.7,"time":"10m","color":"#3DB33F"}]});
trainingArray.push({"Name":"zone3_3hr","TrainingData":[{"ftp":0.85,"time":"60m","color":"#FCD549"},{"ftp":0.82,"time":"60m","color":"#FCD549"},{"ftp":0.78,"time":"60m","color":"#FCD549"}]});
trainingArray.push({"Name":"zone4","TrainingData":[{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.03,"time":"4m","color":"#FC9C49"},{"ftp":0.45,"time":"2m","color":"#3DB39F"},{"ftp":0.97,"time":"20m","color":"#FC9C49"},{"ftp":0.35,"time":"10m","color":"#3DB39F"},{"ftp":0.97,"time":"20m","color":"#FC9C49"},{"ftp":0.35,"time":"10m","color":"#3DB39F"},{"ftp":0.97,"time":"20m","color":"#FC9C49"},{"ftp":0.35,"time":"10m","color":"#3DB39F"}]});
trainingArray.push({"Name":"zone4_15min","TrainingData":[{"ftp":0.6,"time":"3m","color":"#3DB33F"},{"ftp":0.68,"time":"3m","color":"#3DB33F"},{"ftp":0.75,"time":"3m","color":"#3DB33F"},{"ftp":0.83,"time":"3m","color":"#FCD549"},{"ftp":0.9,"time":"3m","color":"#FCD549"},{"ftp":0.6,"time":"3m","color":"#3DB33F"},{"ftp":1.15,"time":"0m30s","color":"#E34074"},{"ftp":0.55,"time":"2.0m","color":"#3DB39F"},{"ftp":1.15,"time":"0m30s","color":"#E34074"},{"ftp":0.55,"time":"2m","color":"#3DB39F"},{"ftp":0.65,"time":"2m","color":"#3DB33F"},{"ftp":0.97,"time":"15m","color":"#FC9C49"},{"ftp":0.35,"time":"5m","color":"#3DB39F"},{"ftp":0.97,"time":"15m","color":"#FC9C49"},{"ftp":0.35,"time":"5m","color":"#3DB39F"},{"ftp":0.97,"time":"15m","color":"#FC9C49"},{"ftp":0.35,"time":"5m","color":"#3DB39F"}]});
trainingArray.push({"Name":"zone4_v2_15min","TrainingData":[{"ftp":0.6,"time":"3m","color":"#3DB33F"},{"ftp":0.7,"time":"3m","color":"#3DB33F"},{"ftp":0.8,"time":"3m","color":"#FCD549"},{"ftp":0.9,"time":"3m","color":"#FCD549"},{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.03,"time":"4m","color":"#FC9C49"},{"ftp":0.45,"time":"2m","color":"#3DB39F"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":0.45,"time":"8m","color":"#3DB39F"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":0.45,"time":"8m","color":"#3DB39F"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":1.05,"time":"3m15s","color":"#FC9C49"},{"ftp":0.95,"time":"4m15s","color":"#FC9C49"},{"ftp":0.45,"time":"8m","color":"#3DB39F"}]});
trainingArray.push({"Name":"zone4_v2_20min","TrainingData":[{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.03,"time":"4m","color":"#FC9C49"},{"ftp":0.45,"time":"2m","color":"#3DB39F"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":0.45,"time":"10m","color":"#3DB39F"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":0.45,"time":"10m","color":"#3DB39F"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.92,"time":"5m","color":"#FC9C49"},{"ftp":0.45,"time":"10m","color":"#3DB39F"}]},{"Name":"zone5","TrainingData":[{"ftp":0.6,"time":"3m","color":"#3DB33F"},{"ftp":0.7,"time":"3m","color":"#3DB33F"},{"ftp":0.8,"time":"3m","color":"#FCD549"},{"ftp":0.55,"time":"2m","color":"#3DB39F"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"5m","color":"#E34074"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"5m","color":"#E34074"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"5m","color":"#E34074"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"5m","color":"#E34074"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"5m","color":"#E34074"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":0.8,"time":"30m","color":"#FCD549"}]});
trainingArray.push({"Name":"zone5_v2_6mins","TrainingData":[{"ftp":0.6,"time":"3m","color":"#3DB33F"},{"ftp":0.7,"time":"3m","color":"#3DB33F"},{"ftp":0.8,"time":"3m","color":"#FCD549"},{"ftp":0.55,"time":"2m","color":"#3DB39F"},{"ftp":1.05,"time":"5m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.05,"time":"6m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.05,"time":"6m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.05,"time":"6m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.05,"time":"6m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":1.05,"time":"6m","color":"#FC9C49"},{"ftp":0.45,"time":"5m","color":"#3DB39F"},{"ftp":0.8,"time":"20m","color":"#FCD549"}]});

trainingArray.push({"Name":"END_1.5hr","TrainingData":[{"ftp":0.75,"time":"10m","color":"#3DB33F"},{"ftp":1.1,"time":"1m","color":"#E34074"},{"ftp":0.55,"time":"3m","color":"#3DB39F"},{"ftp":1.1,"time":"1m","color":"#E34074"},{"ftp":0.55,"time":"3m","color":"#3DB39F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.73,"time":"10m","color":"#3DB33F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.73,"time":"10m","color":"#3DB33F"},{"ftp":1.15,"time":"3m","color":"#E34074"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":1.15,"time":"3m","color":"#E34074"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":1.15,"time":"3m","color":"#E34074"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":1.15,"time":"3m","color":"#E34074"},{"ftp":0.75,"time":"5m","color":"#3DB33F"},{"ftp":0.55,"time":"10m","color":"#3DB39F"}]});
trainingArray.push({"Name":"END_2.0hr","TrainingData":[{"ftp":0.73,"time":"15m","color":"#3DB33F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.73,"time":"10m","color":"#3DB33F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.73,"time":"10m","color":"#3DB33F"},{"ftp":1.0,"time":"10m","color":"#FC9C49"},{"ftp":0.73,"time":"10m","color":"#3DB33F"},{"ftp":1.1,"time":"3m","color":"#E34074"},{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"3m","color":"#E34074"},{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"3m","color":"#E34074"},{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":1.1,"time":"3m","color":"#E34074"},{"ftp":0.55,"time":"5m","color":"#3DB39F"},{"ftp":0.55,"time":"10m","color":"#3DB39F"}]});
trainingArray.push({"Name":"補班日_周五用_RECOVERY","TrainingData":[{"ftp":0.75,"time":"20m","color":"#3DB33F"},{"ftp":1.4,"time":"0m20s","color":"#8963D8"},{"ftp":0.3,"time":"0m20s x 10","color":"#3DB39F"},{"ftp":0.7,"time":"20.00m","color":"#3DB33F"},{"ftp":1.4,"time":"0m20s","color":"#8963D8"},{"ftp":0.3,"time":"0m20s x 10","color":"#3DB39F"},{"ftp":0.7,"time":"15.00m","color":"#3DB33F"}]});

trainingArray.push({"Name":"BaseBuild_II","TrainingData":[{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":1.0,"time":"1m","color":"#FC9C49"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":1.0,"time":"1m","color":"#FC9C49"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":1.0,"time":"1m","color":"#FC9C49"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.8,"time":"5m","color":"#FCD549"},{"ftp":1.0,"time":"1m","color":"#FC9C49"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.88,"time":"5m","color":"#FCD549"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.88,"time":"5m","color":"#FCD549"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.88,"time":"5m","color":"#FCD549"},{"ftp":0.7,"time":"5m","color":"#3DB33F"},{"ftp":0.88,"time":"5m","color":"#FCD549"},{"ftp":0.7,"time":"5m","color":"#3DB33F"}]});

var weight;
$(document).ready(function () {
			
	var result =queryTrainingData('zone2_2hr');
		
	console.log(result);
	
    let url_string = window.location;
    let url = new URL(url_string);

    weight = url.searchParams.get("w");
    if (weight == null) {
        weight = 68;
    }

    var targetFTP = getDefaultFTP();

    var ftpWeight = parseFloat(parseInt(targetFTP) / parseInt(weight)).toFixed(2);



    $('#ftpWeight').text(ftpWeight);

    initJQTable(parseFloat(targetFTP));

    $.each(trainingArray, function (key, value) {
        console.log(value);
        console.log(value.Name);


        var newOption = document.createElement('option');

        newOption.value = value.Name;        
        newOption.textContent = value.Name;

        $('#Lesson').append(newOption);
        
    });
});

function btnClick() {
    var targetFTP = $('#ftpValue').val();

    var targetWeight = parseInt($('#weightValue').val());

    if (parseInt(targetWeight)) {
        weight = targetWeight;
    }
	if (isNaN(parseInt(targetFTP)))
		targetFTP = getDefaultFTP();
	
    
	$('#example tbody').empty();

	$('#ftpZoneTable tbody').empty();

	var ftpWeight = parseFloat(parseInt(targetFTP) / parseInt(weight)).toFixed(2);
	$('#ftpWeight').text(ftpWeight);
	
	var lessonName = $('#Lesson').val();
	initJQTable(+targetFTP,lessonName);
    
    $('#finishedTable tbody').empty();
}

function initJQTable(targetFTP,name) {    
	var traingingData =[];
	if(name==undefined || name=='')
	{
		traingingData= queryTrainingData('zone2_2hr')[0]["TrainingData"];
	}
	else		
	{
		traingingData= queryTrainingData(name)[0]["TrainingData"];
	}
		
	
	$('#traingTable').DataTable({paging: false, ordering: false, info: false, bFilter: false, bInfo: false, destroy: true, dom: 'Bfrtip'});
    $('#ftpZoneTable').DataTable({paging: false, ordering: false, info: false, bFilter: false, bInfo: false, destroy: true, dom: 'Bfrtip'});
	
	 $.each(traingingData, function (key, value) {
        var ftpValue = targetFTP;
        var cell0 = Math.floor(value["ftp"]*targetFTP);
                
        var background = value["color"];

		var cell1 = value["time"];

        student += '<tr>';

        var colorClass = '';

        student += '<td colspan="2" style="background-color:' + background + ';"">' + cell0 +'   @'+ cell1 +'</td>';
		
                
        student += '</tr>';
    });
    $('#traingTable').append(student);   
	
	
    $(".dataTables_empty").empty();
    $('.odd').hide();

   

    var ftpRange = [
          { "Zone": 1, "From": 0, "To": 0.55, "Color": "#3DB39F" }
        , { "Zone": 2, "From": 0.56, "To": 0.75, "Color": "#3DB33F" }
        , { "Zone": 3, "From": 0.76, "To": 0.9, "Color": "#FCD549" }
        , { "Zone": 4, "From": 0.91, "To": 1.05, "Color": "#FC9C49" }
        , { "Zone": 5, "From": 1.06, "To": 1.2, "Color": "#E34074" }
        , { "Zone": 6, "From": 1.21, "To": 1.5, "Color": "#8963D8" }];


    var student = '';
    $('#weight').text('Weight:' + weight);
    $('#ftp').text('FTP:' + targetFTP);
    $('#ftpZone1').text('FTP:' + targetFTP);
	$('#ftpZone2').text('FTP:' + targetFTP);

    $.each(ftpRange, function (key, value) {
        var ftpValue = targetFTP;
        var cell0 = Math.floor(value["From"] * 100) + '%';
        var cell1 = Math.floor(value["To"] * 100) + '%';
        var cell2 = value["Zone"];
        var background = value["Color"];

        var ftpFrom = ftpValue * value["From"];
        var ftpTo = ftpValue * value["To"];

        student += '<tr>';

        var colorClass = '';

        student += '<td class="cellRight_nonFTP" style="background-color:' + background + ';"">' + cell0 + '</td>';
        student += '<td class="cellRight_nonFTP" style="background-color:' + background + ';"">' + cell1 + '</td>';
        student += '<td class="cellRight_nonFTP" style="background-color:' + background + ';"">' + cell2 + '</td>';
        student += '<td class="cellRight_nonFTP" style="background-color:' + background + ';"">' + Math.floor(ftpFrom) + '</td>';
        student += '<td class="cellRight_nonFTP" style="background-color:' + background + ';"">' + Math.floor(ftpTo) + '</td>';

        var ftpDivideWeight = (Math.floor(ftpFrom)/weight).toFixed(1) +"~" + (Math.floor(ftpTo)/weight).toFixed(1);
        student += '<td class="cellRight_nonFTP">' + ftpDivideWeight + '</td>';

        student += '</tr>';
    });
    $('#ftpZoneTable').append(student);    
		

    $('#traingTable tbody tr').click(function() { 
        var dom =$(this);

                
        console.log(dom);
        $('#finishedTable tbody').append(dom);
    }); 
}


function queryTrainingData(name)
{
	var result =$.grep(trainingArray, function (h) {
	  return h.Name == name;
	});
	
	return result;
}

function getDefaultFTP()
{
	let url_string = window.location;
    let url = new URL(url_string);
	
	var targetFTP = url.searchParams.get("ftp");
    if (targetFTP == null) {
        targetFTP = 300;
    }
	return targetFTP;
}
